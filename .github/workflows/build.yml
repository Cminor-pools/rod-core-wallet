name: Build on Linux     

on: [push, pull_request]
jobs:
  build:
    env:
      GLOBAL_CONFIG="--enable-reduce-exports"
    runs-on: ubuntu-18.04
    defaults:
      run:
        shell: bash
    strategy:
      fail-fast: false
    steps:
    - name: Get Source
      uses: actions/checkout@v2
    - name: Setup Environment
      run: |
        sudo apt-get update
        sudo apt-get upgrade
        sudo apt-get install build-essential libtool autotools-dev automake pkg-config libssl-dev libevent-dev bsdmainutils python3 libboost-system-dev libboost-filesystem-dev libboost-chrono-dev libboost-test-dev libboost-thread-dev
        sudo apt-get install software-properties-common
        sudo apt-add-repository "ppa:ondrej/php" -y
        sudo apt-add-repository "ppa:bitcoin/bitcoin" -y
        sudo apt-add-repository "ppa:deadsnakes/ppa" -y
        sudo apt-get update
        sudo apt-get install git libdb4.8-dev libdb4.8++-dev libminiupnpc-dev libzmq3-dev libqt5gui5 libqt5core5a libqt5dbus5 qttools5-dev qttools5-dev-tools libprotobuf-dev protobuf-compiler libqrencode-dev libboost-program-options-dev    
    - name: depends cache files
      uses: actions/cache@v2
      with:
        path: |
          depends/built
          depends/sdk-sources
     - name: autogen
       run: ./autogen.sh
     - name: configure
       run: ./configure
     - name: make
       run: |
         make -j2
         sudo make install
